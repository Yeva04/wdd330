import{a as d,s as u}from"./utils-Dn-3GGK0.js";import{P as i}from"./ProductData-Bu4vevRq.js";class a{constructor(t){this.product=t}calculateDiscount(){const t=this.product.SuggestedRetailPrice||this.product.ListPrice,e=this.product.FinalPrice||this.product.ListPrice;return t&&e&&t>e?{discountPercentage:`${((t-e)/t*100).toFixed(0)}%`,originalPrice:`$${t.toFixed(2)}`,discountedPrice:`$${e.toFixed(2)}`}:null}renderDiscount(){const t=this.calculateDiscount(),e=document.createElement("p");e.id="product-discount",t?e.innerHTML=`Save <strong>${t.discountPercentage}</strong>! Was <s>${t.originalPrice}</s>, Now ${t.discountedPrice}`:e.textContent="No discount available.";const o=document.getElementById("product-description");o?o.parentNode.insertBefore(e,o.nextSibling):console.error("product-description element not found")}}const l=d("product"),p=new i("tents");let c=null;class s{constructor(t,e){if(c)return c;this.productId=t,this.product={},this.dataSource=e,c=this}async init(){if(this.product&&Object.keys(this.product).length>0){console.log("Product already initialized, skipping re-init");return}try{if(this.product=await this.dataSource.findProductById(this.productId),!this.product){console.error("Product not found for ID:",this.productId),document.querySelector(".product-detail").innerHTML="<p>Product not found. Please check the URL (e.g., ?product=880RR).</p>";return}console.log("Product loaded:",this.product),this.renderProductDetails(),this.addToCartButton(),this.applyDiscount()}catch(t){console.error("Error initializing ProductDetails:",t),document.querySelector(".product-detail").innerHTML="<p>Error loading product. Please try again later.</p>"}}addToCartButton(){const t=document.getElementById("addToCart");t&&!t.dataset.listener?(t.addEventListener("click",()=>{let e=localStorage.getItem("so-cart")?JSON.parse(localStorage.getItem("so-cart")):[];Array.isArray(e)||(e=[]);const o={...this.product,Id:this.product.Id};e.push(o),u("so-cart",e),console.log("Cart updated:",e),alert("Item added to cart!"),t.dataset.listener="true"}),t.dataset.listener="true"):t||console.error("addToCart button not found in DOM")}renderProductDetails(){var t,e;document.getElementById("product-brand").textContent=this.product.Brand.Name||"Unknown Brand",document.getElementById("product-name").textContent=this.product.NameWithoutBrand||this.product.Name||"Unnamed Product",document.getElementById("product-image").src=this.product.Image.replace("../images/tents/","/images/tents/")||"/images/noun_Tent_2517.svg",document.getElementById("product-image").alt=this.product.Name||"Product Image",document.getElementById("product-price").textContent=`$${this.product.ListPrice||this.product.FinalPrice||0}`,document.getElementById("product-color").textContent=((e=(t=this.product.Colors)==null?void 0:t[0])==null?void 0:e.ColorName)||"N/A",document.getElementById("product-description").innerHTML=this.product.DescriptionHtmlSimple||"No description available",document.getElementById("addToCart").dataset.id=this.product.Id}applyDiscount(){new a(this.product).renderDiscount()}}const m=new s(l,p);m.init();const n=d("product");if(!n)console.error("No product ID in URL parameters"),document.querySelector(".product-detail").innerHTML="<p>No product selected. Please use a valid URL (e.g., ?product=880RR).</p>";else{const r=new i("tents");new s(n,r).init()}
